{
  "version": "4.0-current",
  "name": "one-field-workflow",
  "description": "Current workflow using single status field with 22 values",

  "design_rationale": {
    "philosophy": [
      "Single source of truth - one field captures entire state",
      "Each status is a valid, well-defined workflow state",
      "Implicit encoding of multiple concepts in status names",
      "No invalid state combinations possible (enum constraint)"
    ],
    "strengths": [
      "Simple mental model: story has exactly one status",
      "Single field to read/write",
      "CHECK constraint guarantees valid states",
      "Each status has clear, documented behavior",
      "No state synchronization issues"
    ],
    "weaknesses": [
      "22 statuses is a lot to remember",
      "Some statuses conflate workflow stage with hold reason",
      "Loses stage context when blocked/pending",
      "Complex queries to find 'needs human review' items",
      "Adding new states requires understanding all 22 existing ones"
    ]
  },

  "schema": {
    "table": "story_nodes",
    "fields": {
      "status": {
        "type": "TEXT NOT NULL",
        "default": "concept",
        "values": [
          "infeasible", "rejected", "wishlist",
          "concept", "broken", "blocked", "refine",
          "pending", "approved", "planned", "queued", "paused",
          "active",
          "reviewing", "verifying", "implemented",
          "ready", "polish", "released",
          "legacy", "deprecated", "archived"
        ],
        "count": 22,
        "description": "Single field encoding workflow stage, hold state, and disposition"
      },
      "notes": {
        "type": "TEXT",
        "description": "Additional context, especially for holds and dispositions"
      }
    },
    "constraints": [
      "CHECK (status IN ('infeasible', 'rejected', 'wishlist', 'concept', 'broken', 'blocked', 'refine', 'pending', 'approved', 'planned', 'queued', 'paused', 'active', 'reviewing', 'verifying', 'implemented', 'ready', 'polish', 'released', 'legacy', 'deprecated', 'archived'))"
    ],
    "indexes": [
      "CREATE INDEX idx_nodes_status ON story_nodes(status)"
    ]
  },

  "status_categorization": {
    "by_dimension": {
      "workflow_stages": {
        "statuses": ["concept", "approved", "planned", "queued", "active", "reviewing", "verifying", "implemented", "ready", "polish", "released"],
        "count": 11,
        "description": "Linear progression through the pipeline"
      },
      "hold_states": {
        "statuses": ["refine", "broken", "pending", "blocked", "paused"],
        "count": 5,
        "description": "Work is stopped for some reason",
        "note": "Stage context is LOST when entering these states"
      },
      "terminal_dispositions": {
        "statuses": ["rejected", "infeasible", "wishlist", "legacy", "deprecated", "archived"],
        "count": 6,
        "description": "Story has exited the active pipeline"
      }
    },
    "by_human_review_needed": {
      "requires_human_review": {
        "statuses": ["refine", "broken", "pending", "blocked", "paused", "reviewing"],
        "count": 6,
        "description": "Human must take action before story can proceed"
      },
      "may_require_review": {
        "statuses": ["verifying"],
        "count": 1,
        "description": "Depends on verification outcome"
      },
      "no_review_needed": {
        "statuses": ["concept", "approved", "planned", "queued", "active", "implemented", "ready", "polish", "released", "rejected", "infeasible", "wishlist", "legacy", "deprecated", "archived"],
        "count": 15,
        "description": "Can be processed automatically or is terminal"
      }
    },
    "by_orchestrator_processing": {
      "processable_by_automation": {
        "statuses": ["concept", "approved", "planned", "queued", "active", "verifying"],
        "count": 6,
        "description": "Orchestrator can take action on these"
      },
      "blocked_from_automation": {
        "statuses": ["refine", "broken", "pending", "blocked", "paused", "reviewing"],
        "count": 6,
        "description": "Requires human intervention first"
      },
      "completed_or_terminal": {
        "statuses": ["implemented", "ready", "polish", "released", "rejected", "infeasible", "wishlist", "legacy", "deprecated", "archived"],
        "count": 10,
        "description": "No automated action needed"
      }
    }
  },

  "status_definitions": {
    "concept": {
      "category": "workflow_stage",
      "description": "Initial idea, not yet approved",
      "human_review": false,
      "orchestrator_action": "vet-stories checks for conflicts",
      "transitions_to": ["approved", "refine", "broken", "rejected", "infeasible", "wishlist"],
      "transitions_from": [null]
    },
    "refine": {
      "category": "hold_state",
      "description": "Needs more detail before approval",
      "human_review": true,
      "orchestrator_action": "Skip (human must refine)",
      "transitions_to": ["concept", "approved", "rejected"],
      "transitions_from": ["concept"],
      "stage_context_lost": true,
      "implicit_stage": "concept"
    },
    "broken": {
      "category": "hold_state",
      "description": "Something wrong with story definition",
      "human_review": true,
      "orchestrator_action": "Skip (human must fix)",
      "transitions_to": ["concept", "rejected", "archived"],
      "transitions_from": ["concept"],
      "stage_context_lost": true,
      "implicit_stage": "concept"
    },
    "pending": {
      "category": "hold_state",
      "description": "Waiting for human decision",
      "human_review": true,
      "orchestrator_action": "Skip (human must decide)",
      "transitions_to": ["concept", "approved", "rejected", "blocked"],
      "transitions_from": ["concept", "approved", "planned", "queued", "active"],
      "stage_context_lost": true,
      "implicit_stage": "unknown - could be any"
    },
    "blocked": {
      "category": "hold_state",
      "description": "External dependency preventing progress",
      "human_review": true,
      "orchestrator_action": "Skip (wait for dependency)",
      "transitions_to": ["concept", "approved", "planned", "queued", "active"],
      "transitions_from": ["concept", "approved", "planned", "queued", "active"],
      "stage_context_lost": true,
      "implicit_stage": "unknown - could be any"
    },
    "approved": {
      "category": "workflow_stage",
      "description": "Approved for implementation, awaiting planning",
      "human_review": false,
      "orchestrator_action": "plan-stories creates TDD plan",
      "transitions_to": ["planned", "pending", "blocked", "rejected"],
      "transitions_from": ["concept", "refine", "pending", "blocked"]
    },
    "planned": {
      "category": "workflow_stage",
      "description": "TDD implementation plan created",
      "human_review": false,
      "orchestrator_action": "Can be queued or executed",
      "transitions_to": ["queued", "active", "pending", "blocked"],
      "transitions_from": ["approved"]
    },
    "queued": {
      "category": "workflow_stage",
      "description": "In backlog, ready to start when capacity available",
      "human_review": false,
      "orchestrator_action": "Execute when ready",
      "transitions_to": ["active", "pending", "blocked"],
      "transitions_from": ["planned"]
    },
    "paused": {
      "category": "hold_state",
      "description": "Execution blocked by critical issue (security, architecture)",
      "human_review": true,
      "orchestrator_action": "Skip (human must resolve blocking issue)",
      "transitions_to": ["active", "rejected", "archived"],
      "transitions_from": ["active"],
      "stage_context_lost": true,
      "implicit_stage": "active"
    },
    "active": {
      "category": "workflow_stage",
      "description": "Currently being implemented",
      "human_review": false,
      "orchestrator_action": "story-execution runs TDD cycles",
      "transitions_to": ["reviewing", "verifying", "paused", "pending", "blocked"],
      "transitions_from": ["planned", "queued", "reviewing", "paused"]
    },
    "reviewing": {
      "category": "workflow_stage",
      "description": "Post-execution, human reviewing decisions made during execution",
      "human_review": true,
      "orchestrator_action": "Skip (human must review)",
      "transitions_to": ["verifying", "active"],
      "transitions_from": ["active", "verifying"]
    },
    "verifying": {
      "category": "workflow_stage",
      "description": "Acceptance criteria being validated",
      "human_review": "maybe",
      "orchestrator_action": "story-verification validates criteria",
      "transitions_to": ["implemented", "reviewing", "active"],
      "transitions_from": ["active", "reviewing"]
    },
    "implemented": {
      "category": "workflow_stage",
      "description": "Code complete, verified, not yet released",
      "human_review": false,
      "orchestrator_action": "None (manual promotion to ready)",
      "transitions_to": ["ready"],
      "transitions_from": ["verifying"]
    },
    "ready": {
      "category": "workflow_stage",
      "description": "Tested, ready for production release",
      "human_review": false,
      "orchestrator_action": "None (manual release)",
      "transitions_to": ["polish", "released"],
      "transitions_from": ["implemented"]
    },
    "polish": {
      "category": "workflow_stage",
      "description": "Final refinements before release",
      "human_review": false,
      "orchestrator_action": "None",
      "transitions_to": ["released"],
      "transitions_from": ["ready"]
    },
    "released": {
      "category": "workflow_stage",
      "description": "Deployed to production",
      "human_review": false,
      "orchestrator_action": "None (terminal for active work)",
      "transitions_to": ["legacy", "deprecated", "archived"],
      "transitions_from": ["ready", "polish"]
    },
    "rejected": {
      "category": "terminal_disposition",
      "description": "Explicitly declined - will not implement",
      "human_review": false,
      "orchestrator_action": "None (terminal)",
      "transitions_to": [],
      "transitions_from": ["concept", "refine", "approved", "planned", "paused"]
    },
    "infeasible": {
      "category": "terminal_disposition",
      "description": "Cannot implement - technical or business constraints",
      "human_review": false,
      "orchestrator_action": "None (terminal)",
      "transitions_to": [],
      "transitions_from": ["concept", "approved", "planned"]
    },
    "wishlist": {
      "category": "terminal_disposition",
      "description": "Low priority, maybe someday",
      "human_review": false,
      "orchestrator_action": "None (terminal, but can be revived)",
      "transitions_to": ["concept", "approved"],
      "transitions_from": ["concept"]
    },
    "legacy": {
      "category": "terminal_disposition",
      "description": "Old code, still functional",
      "human_review": false,
      "orchestrator_action": "None (terminal)",
      "transitions_to": ["deprecated", "archived"],
      "transitions_from": ["released"]
    },
    "deprecated": {
      "category": "terminal_disposition",
      "description": "Marked for removal",
      "human_review": false,
      "orchestrator_action": "None (terminal)",
      "transitions_to": ["archived"],
      "transitions_from": ["released", "legacy"]
    },
    "archived": {
      "category": "terminal_disposition",
      "description": "No longer relevant, preserved for history",
      "human_review": false,
      "orchestrator_action": "None (terminal)",
      "transitions_to": [],
      "transitions_from": ["any"]
    }
  },

  "orchestrator_logic": {
    "gate_job": {
      "description": "Check STORY_AUTOMATION_ENABLED"
    },
    "drain_pipeline": {
      "steps": {
        "plan_stories": {
          "query": "SELECT * FROM story_nodes WHERE status = 'approved'",
          "on_success": "UPDATE status = 'planned'",
          "on_blocking_issue": "UPDATE status = 'paused', notes = '...'",
          "note": "Simple single-status check"
        },
        "write_stories": {
          "query": "Check capacity (exclude terminal statuses)",
          "capacity_query": "WHERE status NOT IN ('rejected', 'infeasible', 'wishlist', 'legacy', 'deprecated', 'archived')",
          "on_success": "INSERT with status = 'concept'",
          "note": "Must list all 6 terminal statuses to exclude"
        },
        "vet_stories": {
          "query": "SELECT * FROM story_nodes WHERE status = 'concept'",
          "on_conflict_needs_human": "UPDATE status = 'pending'",
          "on_auto_resolved": "No change",
          "note": "Loses stage context - was at concept, now pending"
        }
      }
    },
    "human_review_queries": {
      "needs_review": "SELECT * FROM story_nodes WHERE status IN ('refine', 'broken', 'pending', 'blocked', 'paused', 'reviewing')",
      "note": "Must know which 6 statuses mean 'needs review'"
    }
  },

  "skill_behavior": {
    "story_planning": {
      "input_status": "approved",
      "output_status_success": "planned",
      "output_status_blocked": "paused or pending"
    },
    "story_execution": {
      "input_status": "planned or queued",
      "ci_mode_outcomes": {
        "blocking_issue": "paused",
        "deferrable_issue": "reviewing",
        "clean_execution": "verifying"
      }
    },
    "story_vetting": {
      "input_status": "concept",
      "ci_mode_outcomes": {
        "auto_resolved": "no change",
        "needs_human": "pending"
      },
      "note": "DEFER_PENDING loses that story was at concept stage"
    },
    "story_verification": {
      "input_status": "verifying",
      "outcomes": {
        "all_pass": "implemented",
        "any_fail": "stays verifying",
        "untestable": "reviewing"
      }
    }
  },

  "valid_state_analysis": {
    "total_states": 22,
    "state_space": "Exactly 22 valid states (enum)",
    "invalid_states_possible": false,
    "orphan_risk": "Low - every status has defined behavior",
    "cognitive_load": "High - must memorize 22 statuses and their meanings"
  },

  "information_loss_scenarios": {
    "pending_from_multiple_stages": {
      "scenario": "Story at 'planned' needs human decision",
      "action": "UPDATE status = 'pending'",
      "lost": "That it was at 'planned' stage",
      "workaround": "Store in notes: 'pending (was planned): ...'"
    },
    "blocked_from_multiple_stages": {
      "scenario": "Story at 'queued' blocked by external dependency",
      "action": "UPDATE status = 'blocked'",
      "lost": "That it was at 'queued' stage",
      "workaround": "Store in notes: 'blocked (was queued): ...'"
    },
    "paused_always_from_active": {
      "scenario": "Story being executed hits blocking issue",
      "action": "UPDATE status = 'paused'",
      "lost": "Nothing - paused always means 'was active'",
      "note": "This is a clean mapping"
    }
  },

  "workflow_diagram": {
    "ascii": [
      "┌─────────────────────────────────────────────────────────────────────────┐",
      "│                    ONE-FIELD WORKFLOW STATE DIAGRAM                     │",
      "│                         (22 status values)                              │",
      "└─────────────────────────────────────────────────────────────────────────┘",
      "",
      "  LEGEND:  [status]     = workflow stage (11)",
      "           (status)     = hold state (5) - requires human review",
      "           <status>     = terminal disposition (6)",
      "",
      "                              ┌─────────────┐",
      "                              │  [concept]  │",
      "                              └──────┬──────┘",
      "                                     │",
      "          ┌──────────────────────────┼──────────────────────────┐",
      "          │              │           │           │              │",
      "          ▼              ▼           ▼           ▼              ▼",
      "    ┌──────────┐  ┌──────────┐ ┌──────────┐ ┌──────────┐  ┌──────────┐",
      "    │ (refine) │  │ (broken) │ │[approved]│ │<rejected>│  │<wishlist>│",
      "    │ REVIEW   │  │ REVIEW   │ │          │ │ TERMINAL │  │ TERMINAL │",
      "    └────┬─────┘  └────┬─────┘ └────┬─────┘ └──────────┘  └──────────┘",
      "         │              │           │",
      "         └──────────────┴───────────┤",
      "                                    │",
      "          ┌──────────────────────────┼──────────────────────────┐",
      "          │                          │                          │",
      "          ▼                          ▼                          ▼",
      "    ┌──────────┐              ┌──────────┐               ┌──────────┐",
      "    │(pending) │              │ [planned]│               │(blocked) │",
      "    │ REVIEW   │◄────────────►│          │◄─────────────►│ REVIEW   │",
      "    └──────────┘              └────┬─────┘               └──────────┘",
      "         ▲                         │                          ▲",
      "         │                         ▼                          │",
      "         │                   ┌──────────┐                     │",
      "         │                   │ [queued] │                     │",
      "         ├───────────────────┤          ├─────────────────────┤",
      "         │                   └────┬─────┘                     │",
      "         │                        │                           │",
      "         │                        ▼                           │",
      "         │        ┌──────────────────────────────┐            │",
      "         │        │          [active]            │            │",
      "         └────────┤                              ├────────────┘",
      "                  └──────┬───────────────┬───────┘",
      "                         │               │",
      "              ┌──────────┴───┐           │",
      "              │              │           │",
      "              ▼              ▼           ▼",
      "        ┌──────────┐  ┌──────────┐ ┌──────────┐",
      "        │ (paused) │  │[reviewing]│ │[verifying]│",
      "        │ REVIEW   │  │ REVIEW   │ │          │",
      "        └────┬─────┘  └────┬─────┘ └────┬─────┘",
      "             │              │           │",
      "             │              └─────┬─────┘",
      "             │                    │",
      "             │                    ▼",
      "             │             ┌──────────────┐",
      "             │             │[implemented] │",
      "             │             └──────┬───────┘",
      "             │                    │",
      "             │                    ▼",
      "             │             ┌──────────────┐",
      "             │             │   [ready]    │",
      "             │             └──────┬───────┘",
      "             │                    │",
      "             │              ┌─────┴─────┐",
      "             │              ▼           ▼",
      "             │       ┌──────────┐ ┌──────────┐",
      "             │       │ [polish] │ │[released]│",
      "             │       └────┬─────┘ └────┬─────┘",
      "             │            │            │",
      "             │            └─────┬──────┘",
      "             │                  │",
      "             │    ┌─────────────┼─────────────┐",
      "             │    ▼             ▼             ▼",
      "             │ ┌────────┐ ┌──────────┐ ┌──────────┐",
      "             │ │<legacy>│ │<deprecated>│ │<archived>│",
      "             │ │TERMINAL│ │ TERMINAL │ │ TERMINAL │",
      "             │ └────────┘ └──────────┘ └──────────┘",
      "             │                              ▲",
      "             └──────────────────────────────┘",
      "",
      "  ═══════════════════════════════════════════════════════════════════════",
      "",
      "  STATUS COUNTS:",
      "    • Workflow stages:      11  [concept] [approved] [planned] ...",
      "    • Hold states:           5  (refine) (broken) (pending) (blocked) (paused)",
      "    • Terminal dispositions: 6  <rejected> <infeasible> <wishlist> ...",
      "    • TOTAL:                22",
      "",
      "  HUMAN REVIEW NEEDED:  6 statuses",
      "    (refine), (broken), (pending), (blocked), (paused), [reviewing]",
      "",
      "  ORCHESTRATOR QUERY FOR 'NEEDS REVIEW':",
      "    WHERE status IN ('refine','broken','pending','blocked','paused','reviewing')"
    ]
  },

  "comparison_notes": {
    "vs_two_field": {
      "this_system_advantage": "No invalid state combinations, simpler writes",
      "this_system_disadvantage": "Complex review query, loses stage on hold"
    },
    "vs_three_field": {
      "this_system_advantage": "One field, no synchronization issues",
      "this_system_disadvantage": "22 values to memorize, loses stage context"
    }
  }
}
